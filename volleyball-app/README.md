# バレーボールシミュレーター

バレーボールチーム向けの**フォーメーションシミュレーション & 選手管理アプリ**です。

## 機能

### 1. 選手管理
- 選手のCRUD（作成・参照・更新・削除）
- 基本情報：名前、背番号、ポジション、利き手、身長、メモ
- スキル管理：スパイク、ブロック、レシーブ、サーブ、トス、つなぎ、判断（各0-100）
- スキルレーダーチャート表示
- 総合スキル値の自動計算

### 2. コンディション管理
- 日付単位でのコンディション記録
- 記録項目：体調、疲労、痛み（部位含む）、モチベーション、メモ
- 選手別コンディション履歴表示
- ダッシュボードでのチーム俯瞰（平均値、警告表示）

### 3. フォーメーション管理
- 6人制フォーメーションの作成・保存
- コート上の6ポジション（1-6）への選手配置
- リベロ設定対応
- フォーメーション一覧・削除

### 4. シミュレーション機能
- 6ローテーション対応（時計回り回転）
- 各ローテーションでのコート配置可視化
- パフォーマンス指標の自動計算
  - 攻撃力（前衛3名）
  - 守備力（後衛3名）
  - サーブ力（全員）
  - ブロック力（前衛3名）
- コンディションを反映したパフォーマンス補正

### 5. ダッシュボード
- 今日のチーム状態俯瞰
- 平均体調・疲労・モチベーション
- 注意が必要な選手の自動抽出
- クイックアクション（選手追加、フォーメーション作成）

## 技術スタック

- **フロントエンド**: Next.js 16 (App Router) + TypeScript
- **スタイリング**: TailwindCSS v4
- **データベース**: SQLite
- **ORM**: Prisma 7
- **バリデーション**: Zod
- **チャート**: Recharts
- **テスト**: Vitest

## セットアップ

### 1. 依存関係のインストール

```bash
npm install
```

### 2. データベースのセットアップ

**注意**: 現在の開発環境ではPrismaのバイナリダウンロードに問題がある場合があります。
別の環境（ローカルマシンなど）でセットアップすることをお勧めします。

```bash
# マイグレーション実行
npm run db:migrate

# または手動でSQLiteデータベースを作成
# prisma/migrations/20260112000000_init/migration.sql を実行
```

### 3. Prisma Clientの生成

```bash
npx prisma generate
```

### 4. シードデータの投入

```bash
npm run db:seed
```

サンプルデータ:
- 選手8名（OH×2, OP×1, MB×2, S×2, L×1）
- フォーメーション2種類（基本、攻撃重視）
- 過去5日分のコンディションデータ

### 5. 開発サーバーの起動

```bash
npm run dev
```

http://localhost:3000 でアプリケーションが起動します。

## スクリプト一覧

```bash
npm run dev         # 開発サーバー起動
npm run build       # プロダクションビルド
npm run start       # プロダクションサーバー起動
npm run lint        # ESLint実行
npm run test        # テスト実行
npm run test:watch  # テストをwatch mode で実行
npm run db:migrate  # Prismaマイグレーション実行
npm run db:seed     # シードデータ投入
npm run db:studio   # Prisma Studio起動（DBビューア）
```

## プロジェクト構造

```
volleyball-app/
├── app/
│   ├── actions/          # Server Actions
│   │   ├── players.ts
│   │   ├── conditions.ts
│   │   └── formations.ts
│   ├── players/          # 選手管理ページ
│   ├── formations/       # フォーメーション管理ページ
│   ├── layout.tsx
│   └── page.tsx          # ダッシュボード
├── components/
│   ├── ui/               # 共通UIコンポーネント
│   │   ├── Button.tsx
│   │   ├── Card.tsx
│   │   ├── Input.tsx
│   │   └── Select.tsx
│   ├── Navigation.tsx
│   └── SkillRadar.tsx
├── lib/
│   ├── prisma.ts         # Prisma クライアント
│   ├── scoring.ts        # スコアリングロジック
│   ├── scoring.test.ts   # テスト
│   └── utils.ts          # ユーティリティ関数
├── prisma/
│   ├── schema.prisma     # データベーススキーマ
│   ├── migrations/       # マイグレーションファイル
│   └── seed.ts           # シードデータ
└── package.json
```

## データモデル

### Player（選手）
- 基本情報：名前、背番号、ポジション、利き手、身長
- スキル：7種類（0-100）
- リレーション：Condition（1対多）、FormationPosition（1対多）

### Condition（コンディション）
- 日付、体調、疲労、痛み、モチベーション、メモ
- リレーション：Player（多対1）
- ユニーク制約：playerId + date

### Formation（フォーメーション）
- 名前、説明
- リレーション：FormationPosition（1対多）

### FormationPosition（フォーメーション配置）
- コート上の位置（1-6）
- リベロフラグ
- リレーション：Formation（多対1）、Player（多対1）

## スコアリングロジック

### パフォーマンス計算式

**攻撃力（前衛3名）**
```
攻撃力 = avg(スパイク*0.5 + 判断*0.2 + つなぎ*0.3) × コンディション補正
```

**守備力（後衛3名）**
```
守備力 = avg(レシーブ*0.6 + 判断*0.2 + つなぎ*0.2) × コンディション補正
```

**サーブ力（全員）**
```
サーブ力 = avg(サーブ) × コンディション補正
```

**ブロック力（前衛3名）**
```
ブロック力 = avg(ブロック) × コンディション補正
```

**コンディション補正係数**
```
係数 = (体調 - 疲労 + モチベーション) / 15
範囲: 0.5 ~ 1.2
```

## テスト

スコアリングロジックのユニットテストを実装しています。

```bash
npm run test
```

テスト項目:
- コンディション補正係数の計算
- 総合スキル値の計算
- 攻撃力・守備力の計算
- ローテーション機能
- 前衛・後衛判定

## 今後の拡張案

### 短期（Phase 2）
- [ ] 複数チーム対応
- [ ] ユーザー認証（NextAuth.js）
- [ ] 選手の写真アップロード
- [ ] コンディショングラフの時系列表示（折れ線グラフ）
- [ ] フォーメーションの編集機能
- [ ] エクスポート機能（PDF、CSV）

### 中期（Phase 3）
- [ ] 試合記録機能（スコア、統計）
- [ ] 練習メニュー管理
- [ ] 選手の成長記録・トラッキング
- [ ] チーム間の比較機能
- [ ] モバイルアプリ対応（PWA）

### 長期（Phase 4）
- [ ] AIによるフォーメーション最適化提案
- [ ] リアルタイムコラボレーション
- [ ] ビデオ分析との連携
- [ ] 詳細な統計ダッシュボード
- [ ] チャット・コミュニケーション機能

## ライセンス

MIT

## 作成者

Created with Claude Code
